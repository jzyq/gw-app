### 国网标准接口请求示例与部分说明

2024.12.19 by TH

-----

以下是一个请求示例：

```json
{
    "requestHostIp": "10.11.120.39",
    "requestHostPort": "8766",
    "requestId": "1234abcd-1a2b-4444-3c4d-1a2b3c4d5e6f",
    "objectList": [
        {
            "objectId": "123-1",
            "typeList": [
                "wcaqm", "wcgz", "hxq_gjbs", "xy"
            ],
            "imageUrlList": [
                "wcaqm1.jpg"
            ],
            "imageNormalUrlPath": "",
            "pos": [{
                "areas": [
                    {"x": 0, "y": 0},
                    {"x": 100, "y": 100}
                ]
            }]
        }
    ]
}
```

解释说明：

- 请求接口是**http://{SOURCE}/picAnalyse**，资源地址/picAnalyse是固定的

- `requestHostIp` 和`requestHostPort` 是用来接收推理结果的回调接口的地址和端口信息，完整的回调接口是 **http://{IP}:{PORT}/picAnalyseRetNotify** ，资源地址是固定的

- `requestId`用来区分不同的推理请求，通常是uuid4格式

- `objectList`为待推理的点位列表，包含点位标识、图片数据等信息

- `objectId`为巡检点位id，由业务系统确定

- `typeList`为待调用的算法名称列表，可以有多个

- `imageUrlList`为待处理的图片数据，需要注意的是：
  
  - 图片url均为 **ftp资源地址（默认不带ftp://开头）**，ftp服务器的信息（ip、port、user、passwd等）在另外的配置文件里进行配置，通常ftp服务为主动模式，但python代码似乎需要被动模式才能取到图片，这个根据实际情况进行调试
  
  - 通常情况下1个点位（objectID）只传1张图片，如果算法有特殊需求（如徘徊、走路不稳等），则传固定张数（如6张），将这几张图片作为一组整体进行推理

- `imageNormalUrlPath`是给判别类算法（`typeList == tx_pb`）提供的基准图片，一般直接传空字符串`""`即可

- `pos`为预选框信息，用于`红外温度探测`、`电子围栏（人员入侵）`等算法，需要注意的是：
  
  - 只有`红外温度探测`接受单点传入，返回该点温度值
  
  - 如果传入 **2个点** 信息，则为 **左上角+右下角** 信息
  
  - 如果传入3个点以上的信息，则考虑为多边形顶点信息，顺时针排列



以下是一个返回示例：

```json
{
    "requestId": "1234abcd-1a2b-4444-3c4d-1a2b3c4d5e6f",
    "resultsList": [
        {
            "objectId": "123-1",
            "results": [
                {    # 这是一条图片获取失败的示例
                    "type": 算法名称,
                    "value": "",          # 失败时值为空字符串
                    "code": "2001",       # 2001 固定表示【图片】处理失败
                    "resImageUrl": "",    # 参考图片地址为空字符串
                    "pos": [],            # 失败时值为空列表
                    "conf": 0.0000,
                    "desc": 错误信息
                },{  # 这是一条算法名称不支持（如输入错误）的示例
                    "type": 算法名称,
                    "value": "",          # 失败时值为空字符串
                    "code": "2002",       # 2002 固定表示【算法】处理失败
                    "resImageUrl": "",    # 参考图片地址为空字符串
                    "pos": [],            # 失败时值为空列表
                    "conf": 0.0000,
                    "desc": "暂不支持该算法"
                },{  # 这是一条算法推理失败的示例
                    "type": 算法名称,
                    "value": "",          # 失败时值为空字符串
                    "code": "2002",       # 2002 固定表示【算法】处理失败
                    "resImageUrl": "",    # 参考图片地址为空字符串
                    "pos": [],            # 失败时值为空列表
                    "conf": 0.0000,
                    "desc": 错误信息
                },{  # 这是一条算法处理【成功，但未检测到目标】的示例
                    "type": 算法名称,
                    "value": "0",         # 成功但未检测到值为"0"
                    "code": "2000",       # 2000 固定表示处理成功
                    "resImageUrl": "",    # 参考图片地址为空字符串
                    "pos": [],            # 固定为空列表
                    "conf": 0.0000,       # 固定为 0
                    "desc": "正常"         # 固定为 "正常"
                },{  # 这是一条算法处理【成功，且检测到目标】的示例
                    "type": 算法名称,
                    "value": "1",         # 成功时值为"1"
                    "code": "2000",       # 2000 固定表示处理成功
                    "resImageUrl": "",    # 参考图片地址为空字符串
                    "pos": [              # 可以有多个区域
                        {"areas": [
                            {"x": x1, "y": y1},
                            {"x": x2, "y": y2}
                        ]}
                    ],
                    "conf": 0.8765,       # 置信度为4位小数
                    "desc": 算法名称对应的描述    # 如"未戴安全帽"
                }
            ]
        }
    ]
}
```

解释说明：

- `requestId`对应入参中的同名参数，值相同

- `objectId`对应入参中的同名参数，值相同

- `code`值为3选1： **2000** 正常 **2001** 图片处理/读取失败 **2002** 算法推理失败

- `value`值类型固定为**str**：
  
  - 对于行为、缺陷识别累算法，值为2选1： **0** 为正常 **1** 为异常
  
  - 对于表计读数类算法，值为读数值，如 **3.1415**
  
  - 对于指示灯、开关等识别类算法，值需要单独约定，如 **1** 为红灯闪烁 **2** 为绿灯常亮

- `conf`置信度固定位 **4** 位小数，**如果识别结果中存在多个区域/目标，则conf值为第一个目标的conf值，而不是所有目标的平均conf值（华雁的逻辑）**

- `desc`在未检测到异常时统一返回 **正常**

- `pos`的区域如果是矩形，可以只返回2个点坐标 **（左上+右下）** 否则以 **顺时针** 方向依次列出各点坐标

- `resImageUrl`的地址为参考图片地址，如经推理后给目标画框的图片等，当前可以置空


